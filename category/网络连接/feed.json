{
    "version": "https://jsonfeed.org/version/1",
    "title": "指尖小屋 • All posts by \"网络连接\" category",
    "description": "学习的过程大概就是学了忘,忘了学，抽空多停下来总结，不要冲的太前。",
    "home_page_url": "https://www.fasty97.top",
    "items": [
        {
            "id": "https://www.fasty97.top/2022/10/08/Mirror%E5%88%9D%E4%BD%93%E9%AA%8C/",
            "url": "https://www.fasty97.top/2022/10/08/Mirror%E5%88%9D%E4%BD%93%E9%AA%8C/",
            "title": "Mirror初体验",
            "date_published": "2022-10-08T08:50:30.000Z",
            "content_html": "<h2 id=\"快速食用\"><a class=\"markdownIt-Anchor\" href=\"#快速食用\">#</a> 🔖快速食用</h2>\n<p>在场景中创建一个空物体，并挂载如下几个脚本。</p>\n<h3 id=\"网络管理器\"><a class=\"markdownIt-Anchor\" href=\"#网络管理器\">#</a> 网络管理器</h3>\n<blockquote>\n<p>其中，需要指定 Player Prefab, 勾选自动生成玩家可以在连接到服务器时，自动生成玩家对象。</p>\n</blockquote>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/202210191630256.png\" alt=\"image-20221010100103105\"></p>\n<h3 id=\"玩家\"><a class=\"markdownIt-Anchor\" href=\"#玩家\">#</a> 玩家</h3>\n<p>为玩家添加如下组件：</p>\n<ul>\n<li>Network Identity 表示这是一个需要进行网络同步的物体。</li>\n<li>NetWork Transform 表示可同步 Transfrom</li>\n</ul>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/202210191630897.png\" alt=\"image-20221010100400624\"></p>\n<blockquote>\n<p>PS: 注意勾选认证，让玩家只能控制自己的物体</p>\n</blockquote>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/202210191630794.png\" alt=\"image-20221010100615058\"></p>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"><span>玩家控制脚本</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">Mirror</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">UniRx</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Qpublic <span class=\"token keyword\">class</span> <span class=\"token class-name\">PlayerCtr</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">NetworkBehaviour</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">SerializeField</span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> speed <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">SyncVar</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>hook <span class=\"token operator\">=</span> <span class=\"token keyword\">nameof</span><span class=\"token punctuation\">(</span>OnColorChanged<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token class-name\">Color</span> _color<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token class-name\">MeshRenderer</span> _renderer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Awake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         _renderer <span class=\"token operator\">=</span> <span class=\"token generic-method\"><span class=\"token function\">GetComponent</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MeshRenderer<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isServer<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>             <span class=\"token function\">RpcTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre> </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         Observable<span class=\"token punctuation\">.</span><span class=\"token function\">EveryUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span> isLocalPlayer <span class=\"token operator\">&amp;&amp;</span> Input<span class=\"token punctuation\">.</span><span class=\"token function\">GetKeyDown</span><span class=\"token punctuation\">(</span>KeyCode<span class=\"token punctuation\">.</span>Space<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Subscribe</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"按下空格\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> color <span class=\"token operator\">=</span> _color <span class=\"token operator\">==</span> Color<span class=\"token punctuation\">.</span>white <span class=\"token punctuation\">?</span> Color<span class=\"token punctuation\">.</span>black <span class=\"token punctuation\">:</span> Color<span class=\"token punctuation\">.</span>white<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             <span class=\"token function\">CmdChangeColor</span><span class=\"token punctuation\">(</span>color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre> </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>         <span class=\"token comment\">//move</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>         Observable<span class=\"token punctuation\">.</span><span class=\"token function\">EveryUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span> isLocalPlayer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Subscribe</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>         <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>             <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> h <span class=\"token operator\">=</span> Input<span class=\"token punctuation\">.</span><span class=\"token function\">GetAxis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Horizontal\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>             <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> v <span class=\"token operator\">=</span> Input<span class=\"token punctuation\">.</span><span class=\"token function\">GetAxis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Vertical\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre> </pre></td></tr><tr><td data-num=\"43\"></td><td><pre>             <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Mathf<span class=\"token punctuation\">.</span><span class=\"token function\">Abs</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.1f</span> <span class=\"token operator\">||</span> Mathf<span class=\"token punctuation\">.</span><span class=\"token function\">Abs</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.1f</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>             <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                 <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> dir <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Vector3</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>normalized<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                 transform<span class=\"token punctuation\">.</span><span class=\"token function\">Translate</span><span class=\"token punctuation\">(</span>dir <span class=\"token operator\">*</span> speed <span class=\"token operator\">*</span> Time<span class=\"token punctuation\">.</span>deltaTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre> </pre></td></tr><tr><td data-num=\"51\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnColorChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span> oldColor<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Color</span> newColor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>     <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>         <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"颜色变化\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>         _renderer<span class=\"token punctuation\">.</span>material<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> newColor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre> </pre></td></tr><tr><td data-num=\"57\"></td><td><pre>     <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Command</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">CmdChangeColor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span> color<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>     <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>         _color <span class=\"token operator\">=</span> color<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre> </pre></td></tr><tr><td data-num=\"63\"></td><td><pre> </pre></td></tr><tr><td data-num=\"64\"></td><td><pre>     <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">ClientRpc</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>     <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">RpcTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>     <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>         <span class=\"token comment\">// 在服务器端调用时，分别在客户端进行调用</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>         <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"当前客户端为：</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token expression language-csharp\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>netId</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"参考\"><a class=\"markdownIt-Anchor\" href=\"#参考\">#</a> 参考</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Nha2VfQy9hcnRpY2xlL2RldGFpbHMvMTIzMTY1MTYwP3NwbT0xMDAxLjIwMTQuMzAwMS41NTAy\"> UnityMirror 学习笔记 (2)：使用 SyncVar 进行数据同步_Cake_C 的博客 - CSDN 博客</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Nha2VfQy9hcnRpY2xlL2RldGFpbHMvMTIzMTcxMTIwP3NwbT0xMDAxLjIwMTQuMzAwMS41NTAy\">UnityMirror 学习笔记 (3)：服务器与客户端间的函数调用，互发控制指令：Command，ClientRpc，TargetRpc_Cake_C 的博客 - CSDN 博客</span></li>\n</ul>\n",
            "tags": [
                "多人"
            ]
        },
        {
            "id": "https://www.fasty97.top/2021/04/29/PUN2%EF%BC%88%E4%BA%8C%EF%BC%89%E5%AF%B9%E8%B1%A1%E5%90%8C%E6%AD%A5/",
            "url": "https://www.fasty97.top/2021/04/29/PUN2%EF%BC%88%E4%BA%8C%EF%BC%89%E5%AF%B9%E8%B1%A1%E5%90%8C%E6%AD%A5/",
            "title": "PUN2（二）对象同步",
            "date_published": "2021-04-29T06:58:33.000Z",
            "content_html": "<blockquote>\n<p>对象同步是多人在线游戏的核心在 Pun 中使用 Photon View 组件来同步对象</p>\n</blockquote>\n<h2 id=\"创建同步对象\"><a class=\"markdownIt-Anchor\" href=\"#创建同步对象\">#</a> 创建同步对象</h2>\n<p>创建一个胶囊体，并为其添加 <code>Photon View</code> ， <code>Photon Transform View</code> 、 <code>Photon Rigidbody View</code>  组件使其监听。</p>\n<img data-src=\"https://pic.fasty97.top/NotePad/20210429151825.png\" alt=\"image-20210429151825946\"  />\n<center>Photon View</center>\n<h2 id=\"连接同步\"><a class=\"markdownIt-Anchor\" href=\"#连接同步\">#</a> 连接同步</h2>\n",
            "tags": [
                "unity"
            ]
        },
        {
            "id": "https://www.fasty97.top/2021/03/09/PUN%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87/",
            "url": "https://www.fasty97.top/2021/03/09/PUN%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87/",
            "title": "PUN2（一）前置准备",
            "date_published": "2021-03-09T02:07:15.000Z",
            "content_html": "<h2 id=\"创建app\"><a class=\"markdownIt-Anchor\" href=\"#创建app\">#</a> 创建 APP</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGhvdG9uZW5naW5lLmNvbS8=\">photo 光子服务器官网</span></p>\n<p>在 photo 官网注册后，进入面板，创建一个新 APP，类型选择 PUN</p>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/20210310100355.png\" alt=\"photo\"></p>\n<p>记录下新创建 App 的 App ID</p>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/20210310100925.png\" alt=\"image-20210310100925155\"></p>\n<h2 id=\"下载导入unity-pun\"><a class=\"markdownIt-Anchor\" href=\"#下载导入unity-pun\">#</a> 下载导入 Unity PUN</h2>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/20210310101044.png\" alt=\"image-20210310101044859\"></p>\n<p><img data-src=\"http://pic.fasty97.top/NotePad/20210310101241.png\" alt=\"image-20210310101241690\"></p>\n<h2 id=\"连接到服务器\"><a class=\"markdownIt-Anchor\" href=\"#连接到服务器\">#</a> 连接到服务器</h2>\n<p>使用 <code>PhotonNetwork.ConnectUsingSettings();</code>  来连接到服务器</p>\n<p>可以通过继承 <code>MonoBehaviourPunCallbacks</code>  类来实现连接相关的回调。</p>\n<h3 id=\"简单的连接示例\"><a class=\"markdownIt-Anchor\" href=\"#简单的连接示例\">#</a> 简单的连接示例</h3>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">Photon<span class=\"token punctuation\">.</span>Pun</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">Photon<span class=\"token punctuation\">.</span>Realtime</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">namespace</span> <span class=\"token namespace\">PUNTest</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PunLink</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehaviourPunCallbacks</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Awake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// 同步场景</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            PhotonNetwork<span class=\"token punctuation\">.</span>AutomaticallySyncScene <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 使用设置连接</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            PhotonNetwork<span class=\"token punctuation\">.</span><span class=\"token function\">ConnectUsingSettings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始连接...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnConnected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已连接到服务器\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 连接到主机</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnConnectedToMaster</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// 加入房间</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            PhotonNetwork<span class=\"token punctuation\">.</span><span class=\"token function\">JoinOrCreateRoom</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"room\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">RoomOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>MaxPlayers <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>TypedLobby<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始加入房间\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnJoinedRoom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已加入房间\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"http://pic.fasty97.top/NotePad/20210310110333.gif\" alt=\"ani\"></p>\n<center>效果图</center>",
            "tags": [
                "unity"
            ]
        },
        {
            "id": "https://www.fasty97.top/2020/09/11/Unity%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E6%AD%A5/",
            "url": "https://www.fasty97.top/2020/09/11/Unity%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E6%AD%A5/",
            "title": "Unity热更新初步",
            "date_published": "2020-09-11T04:21:41.000Z",
            "content_html": "<blockquote>\n<p>此文为热更新学习笔记记录</p>\n</blockquote>\n<h3 id=\"ab包\"><a class=\"markdownIt-Anchor\" href=\"#ab包\">#</a> AB 包</h3>\n<p><img data-src=\"https://pic.fasty97.top/blog/20200911/aMXVGwgBYNkX.png\" alt=\"AB包浏览器\"><br>\n<img data-src=\"https://pic.fasty97.top/blog/20200911/8uaUFBUnpFsG.png\" alt=\"AB包配置\"></p>\n<ul>\n<li>LZ4 比标准压缩程度小，但对于内存的占用相对较小，在使用时无需全部解压（<strong>推荐使用</strong>）</li>\n<li>ETI 在资源包中不包含资源的类型信息</li>\n<li>FR 重新打包时需要重新构建包和 ClearFolders 不同，它不会删除不存在的包。</li>\n<li>ITTC 增量构建检查时，忽略类型数的更改</li>\n<li>Append Hash 将文件哈希值附加到资源包名上</li>\n<li>SM 严格模式，如果打包出错，则打包直接失败</li>\n<li>DRB 运行时构建</li>\n</ul>\n<h4 id=\"打包\"><a class=\"markdownIt-Anchor\" href=\"#打包\">#</a> 打包</h4>\n<p>进过 AB 打包后，我们发现生成了如下的文件：<br>\n<img data-src=\"https://pic.fasty97.top/blog/20200911/OOvX2aB3ieJj.png\" alt=\"打包生成文件\"><br>\n其中包含我们的<strong>主包文件</strong> PC 和我们的资源包文件 model。<br>\n打包完成的资源包以<strong>二进制存储</strong><br>\n manifest 文件为对应资源的配置文件。<br>\n<img data-src=\"https://pic.fasty97.top/blog/20200911/2xEeB6noUX5c.png\" alt=\"AB包资源浏览\"></p>\n<h3 id=\"加载资源\"><a class=\"markdownIt-Anchor\" href=\"#加载资源\">#</a> 加载资源</h3>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 加载 AB 包</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> ab<span class=\"token operator\">=</span> AssetBundle<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFromFile</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span>streamingAssetsPath <span class=\"token operator\">+</span> <span class=\"token string\">\"/model\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 加载资源</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> asset<span class=\"token operator\">=</span> ab<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">LoadAsset</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>GameObject<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cube\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">Instantiate</span><span class=\"token punctuation\">(</span>asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 注意 Ab 包不能重复加载（否则会出错）</span></pre></td></tr></table></figure><h4 id=\"异步加载资源\"><a class=\"markdownIt-Anchor\" href=\"#异步加载资源\">#</a> 异步加载资源</h4>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/// &lt;summary></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/// 异步加载资源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/// &lt;/summary></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/// &lt;param name=\"abName\">&lt;/param></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/// &lt;param name=\"resName\">&lt;/param></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/// &lt;param name=\"callBack\">&lt;/param></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/// &lt;typeparam name=\"T\">&lt;/typeparam></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/// &lt;returns>&lt;/returns></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token return-type class-name\">IEnumerator</span> <span class=\"token generic-method\"><span class=\"token function\">LoadAbResAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> abName<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> resName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UnityAction<span class=\"token punctuation\">&lt;</span>AssetBundleRequest<span class=\"token punctuation\">></span></span> callBack<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> ab <span class=\"token operator\">=</span> AssetBundle<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFromFileAsync</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span>streamingAssetsPath <span class=\"token operator\">+</span> <span class=\"token string\">\"/model\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">yield</span> <span class=\"token keyword\">return</span> ab<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> res <span class=\"token operator\">=</span> ab<span class=\"token punctuation\">.</span>assetBundle<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">LoadAssetAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>resName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token keyword\">yield</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tcallBack<span class=\"token punctuation\">.</span><span class=\"token function\">Invoke</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">// 卸载单个 ab 包</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tab<span class=\"token punctuation\">.</span>assetBundle<span class=\"token punctuation\">.</span><span class=\"token function\">Unload</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token comment\">// 卸载所有 Ab 包，选 true 会删除场景上通过 ab 包加载的资源</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tAssetBundle<span class=\"token punctuation\">.</span><span class=\"token function\">UnloadAllAssetBundles</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 异步加载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">StartCoroutine</span><span class=\"token punctuation\">(</span><span class=\"token generic-method\"><span class=\"token function\">LoadAbResAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>GameObject<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"model\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cube\"</span><span class=\"token punctuation\">,</span> a <span class=\"token operator\">=></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"资源加载完成！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">Instantiate</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"资源依赖\"><a class=\"markdownIt-Anchor\" href=\"#资源依赖\">#</a> 资源依赖</h3>\n<p>如果一个资源被打包为 ab 包，那么这个资源使用的其他资源依赖会被默认打入资源包。</p>\n",
            "tags": [
                "unity",
                "热更新"
            ]
        }
    ]
}